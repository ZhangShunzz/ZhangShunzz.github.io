---
layout: post
title:  Python 接口调用 
date:   2018-12-28 17:14:00 +0800
categories: 技术
tag: Python
---


```python

	# !/usr/bin/env python
	# -*- coding: utf-8 -*-
	import json
	import os
	import datetime
	import requests
	import urllib,urllib2
	import sys
	import simplejson
	 
	reload(sys)
	sys.setdefaultencoding('utf-8')
	#POST请求业务接口
	def run(method,url,data):
	        headers = {
	                'content-type':'application/json',
	                'Authorization':'Basic aGVhbHRoY2hlY2tAaW50ZWxsaWNyZWRpdC5jbjpqZXJyeTM5OlBASGVhbHRoY2hlY2s='
	        }
	        if method == 'POST':
	                data_json = json.dumps(data)
	                start_time = datetime.datetime.now()
	                raw = requests.post(url,data_json,headers=headers)
	                end_time = datetime.datetime.now()
	                Rtime=(end_time-start_time).microseconds / 1000
	                status = raw.status_code
	                subject = '%s status:\t%s\n%s 时延:%s' %(url,status,url,Rtime)
	                return subject
	#获取access_token
	def gettoken(corpid,corpsecret):
	    gettoken_url = 'https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=' + corpid + '&corpsecret=' + corpsecret
	    print  gettoken_url
	    try:
	        token_file = urllib2.urlopen(gettoken_url)
	    except urllib2.HTTPError as e:
	        print e.code
	        print e.read().decode("utf8")
	        sys.exit()
	    token_data = token_file.read().decode('utf-8')
	    token_json = json.loads(token_data)　　
	    token_json.keys()
	    token = token_json['access_token']
	    return token
	#给企业微信发消息
	def senddata(access_token,subject):
	    send_url = 'https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=' + access_token
	    send_values = {
	        "touser":"ZhangShun",
	        "toparty":"1",
	        "msgtype":"text",
	        "agentid":"1000002",
	        "text":{
	            "content":subject
	           },
	        "safe":"0"
	        }
	#    send_data = json.dumps(send_values, ensure_ascii=False)
	    send_data = simplejson.dumps(send_values, ensure_ascii=False).encode('utf-8')
	    send_request = urllib2.Request(send_url, send_data)
	    response = json.loads(urllib2.urlopen(send_request).read())　　
	    print str(response)
	 
	if __name__ == '__main__':
	        url = 'http://1.1.1.1:8080/api/v1/'
	        data = {
	        "name":"二三三",
	        "pid":"4A99881B1C1AEF6B7220245439FEA196A1F6BDF01C3FD8E1FA750640497419FF",
	        "mobile":"BDA6E1DE2852BA16AE1F88A7D426AD26CECCBB5F570122EAA368CF0A03313D12"
	 
	}
	        subject = run('POST',url,data)
	        corpid =  'xxxxxxxxxxxxxxx'　　#CorpID是企业号的标识
	        corpsecret = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'　　#corpsecretSecret是企业微信应用的密钥
	        accesstoken = gettoken(corpid,corpsecret)
	        senddata(accesstoken,subject)

```
